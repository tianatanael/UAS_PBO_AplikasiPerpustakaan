<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap/css2/staff_dashboard.css') }}">
    <title>Home</title>
</head>
<body>

     <!-- Side navigation -->
     <div class="sidenav">
        <a {% if home %}class="checked"{% endif %} href="/staff/dashboard">Home</a>
        <a href="/staff/logout" onclick="return confirm('Anda yakin mau logout?')">Log Out</a>
    </div>

    <div class="main">
        <div class="container">
            <h1 style="text-align: center;">Ketersediaan Buku</h1>
            <!-- Input untuk pencarian berdasarkan judul buku -->
            <div class="data-pegawai">
            <div class="mb-3">
                <input type="text" id="searchInput" class="form-control" placeholder="Cari berdasarkan judul buku">
            </div>
            
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Id Buku</th>
                        <th>Judul</th>
                        <th>Penulis</th>
                        <th>Penerbit</th>
                        <th>Tanggal Terbit</th>
                        <th>Lokasi</th>
                        <th>Tersedia</th>
                        <th width="15%">Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in container %}
                    <tr>
                        <td>{{ row[0] }}</td>
                        <td>{{ row[1] }}</td>
                        <td>{{ row[2] }}</td>
                        <td>{{ row[3] }}</td>
                        <td>{{ row[4].strftime('%d/%m/%Y') }}</td>
                        <td>{{ row[5] }}</td>
                        <td>{{ row[6] }}</td>
                        <td>{{ row[7].strftime('%d/%m/%Y')}}</td>
                        <td>
                            <div class="btn-group" role="group">
                                <a href="/staff/collection/edit/{{row[0]}}" class="btn btn-warning" role="button">Edit</a>
                                <a href="/staff/collection/hapus/{{row[0]}}" class="btn btn-danger" role="button" onclick="return confirm('Apakah Anda yakin ingin menghapus buku ini?')">Delete</a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <!-- Pagination -->
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                    <li class="page-item" id="previous"><a class="page-link" href="#">Sebelumnya</a></li>
                    <li class="page-item" id="page1"><button class="page-link btn btn-link">1</button></li>
                    <li class="page-item" id="page2"><button class="page-link btn btn-link">2</button></li>
                    <li class="page-item" id="page3"><button class="page-link btn btn-link">3</button></li>
                    <li class="page-item" id="next"><a class="page-link" href="#">Selanjutnya</a></li>
                </ul>
            </nav>
            <a class="right btn btn-primary" href="/staff/collection/tambah">Tambah Buku</a>
        </div>
        </div>
      </div>
        
        <!-- JavaScript untuk Bootstrap -->
        <script src="{{ url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script>
        
        <script>
            var currentPage = 1;
            var itemsPerPage = 4;
            var totalRows = document.querySelectorAll('tbody tr').length;
    
            function displayData(page) {
                var startIndex = (page - 1) * itemsPerPage;
                var endIndex = startIndex + itemsPerPage;
    
                var rows = document.querySelectorAll('tbody tr');
                for (var i = 0; i < rows.length; i++) {
                    if (i >= startIndex && i < endIndex) {
                        rows[i].style.display = "";
                    } else {
                        rows[i].style.display = "none";
                    }
                }
            }
    
            function updatePaginationButtons() {
                var totalPages = Math.ceil(totalRows / itemsPerPage);
                var page1 = document.getElementById('page1');
                var page2 = document.getElementById('page2');
                var page3 = document.getElementById('page3');
    
                if (currentPage <= 3) {
                    page1.innerHTML = '<button class="page-link btn btn-link">1</button>';
                    page2.innerHTML = '<button class="page-link btn btn-link">2</button>';
                    page3.innerHTML = '<button class="page-link btn btn-link">3</button>';
                } else {
                    page1.innerHTML = '<button class="page-link btn btn-link">' + (currentPage - 1) + '</button>';
                    page2.innerHTML = '<button class="page-link btn btn-link">' + currentPage + '</button>';
                    page3.innerHTML = '<button class="page-link btn btn-link">' + (currentPage + 1) + '</button>';
                }
            }
    
            displayData(currentPage);
            updatePaginationButtons();
    
            document.getElementById('previous').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    displayData(currentPage);
                    updatePaginationButtons();
                }
            });
    
            document.getElementById('next').addEventListener('click', function() {
                if (currentPage < Math.ceil(totalRows / itemsPerPage)) {
                    currentPage++;
                    displayData(currentPage);
                    updatePaginationButtons();
                }
            });
    
            document.getElementById('page1').addEventListener('click', function() {
                currentPage = parseInt(this.textContent);
                displayData(currentPage);
                updatePaginationButtons();
            });
    
            document.getElementById('page2').addEventListener('click', function() {
                currentPage = parseInt(this.textContent);
                displayData(currentPage);
                updatePaginationButtons();
            });
    
            document.getElementById('page3').addEventListener('click', function() {
                currentPage = parseInt(this.textContent);
                displayData(currentPage);
                updatePaginationButtons();
            });
    
            // Fungsi pencarian
            document.getElementById('searchInput').addEventListener('keyup', function() {
                var searchText = this.value.toLowerCase();
                var rows = document.querySelectorAll('tbody tr');
                for (var i = 0; i < rows.length; i++) {
                    // Assuming row[1] is the second <td> in the row
                    var titleCell = rows[i].querySelectorAll('td')[1]; 
                    if (titleCell) {
                        var titleText = titleCell.textContent.toLowerCase();
                        if (titleText.includes(searchText)) {
                            rows[i].style.display = "";
                        } else {
                            rows[i].style.display = "none";
                        }
                    }
                }
                currentPage = 1; // Reset to the first page after search
                updatePaginationButtons();
            });
        </script>

</body>
</html>